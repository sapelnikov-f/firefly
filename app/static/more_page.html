<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–∞—Ä—à—Ä—É—Ç</title>
    <link rel="stylesheet" href="./static/css/more_style.css">
</head>
<body>

<div class="page">

    <div class="top-header">
        <img src="./static/photos/–ª–æ–≥–æ.jpg" alt="SVET'lachok" class="logo-left">
        <div class="direction" id="direction"></div>
        <div></div>
    </div>

    <section class="intro">
        <p>
            –ö–æ–º–∞–Ω–¥–∞ <b>SVET‚Äôlachok</b> –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –≤–∞—Å –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
            –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç.
        </p>
    </section>

    <section class="summary">
        <div class="stats">
            <div class="stat">
                <span>–ü–æ–¥—ä—ë–º</span>
                <b id="stat-ascent"></b>
            </div>
            <div class="stat">
                <span>–î–∏—Å—Ç–∞–Ω—Ü–∏—è</span>
                <b id="stat-distance"></b>
            </div>
            <div class="stat">
                <span>–í—Ä–µ–º—è</span>
                <b id="stat-time"></b>
            </div>
            <div class="stat">
                <span>–û—Å—Ç–∞–Ω–æ–≤–æ–∫</span>
                <b id="stat-stops"></b>
            </div>
        </div>
    </section>

    <div class="actions pdf-hide">
        <button class="btn-pdf" onclick="downloadPDF()">–°–∫–∞—á–∞—Ç—å PDF</button>
    </div>

    <section class="route" id="route"></section>

    <div class="page-break"></div>

    <section class="legend no-break">
        <h4>–õ–µ–≥–µ–Ω–¥–∞ –º–∞—Ä—à—Ä—É—Ç–∞</h4>
        <ul>
            <li>üü¢ –°—Ç–æ—è–Ω–∫–∞ ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –∏ –Ω–æ—á—ë–≤–∫–∏</li>
            <li>üîµ –ü–µ—Ä–µ–≤–∞–ª ‚Äî –≤—ã—Å–æ—Ç–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞</li>
        </ul>
    </section>

    <section class="disclaimer no-break">
        <p>
            –ú–∞—Ä—à—Ä—É—Ç –Ω–æ—Å–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
            –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–ª—å–µ—Ñ–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –º–µ—Å—Ç–Ω–æ—Å—Ç–∏.
        </p>
        <p>
            –£—á–∞—Å—Ç–Ω–∏–∫ –º–∞—Ä—à—Ä—É—Ç–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É,
            –æ—Ü–µ–Ω–∫—É –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π, –≤—ã–±–æ—Ä —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
        </p>
    </section>

    <div class="sign">
        <p>–° —É–≤–∞–∂–µ–Ω–∏–µ–º,</p>
        <p class="company">SVET‚Äôlachok</p>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
function downloadPDF() {
    const element = document.querySelector('.page');

    document.querySelectorAll('.pdf-hide').forEach(el => {
        el.style.display = 'none';
    });

    const title = document.getElementById('direction').textContent;
    const filename = title
        .replace(/\s*‚Üí\s*/g, '_')
        .replace(/\s+/g, '-')
        .replace(/[^a-zA-Z0-9–ê-–Ø–∞-—è_-]/g, '') + '.pdf';

    html2pdf().set({
        margin: [0, 0, 0, 0],            
        filename,
        pagebreak: {
            mode: ['css'],
            before: '.page-break',      
            avoid: '.no-break'           
        },
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    })
    .from(element)
    .save()
    .then(() => {
        document.querySelectorAll('.pdf-hide').forEach(el => {
            el.style.display = '';
        });
    });
}

fetch('test.json')
    .then(r => r.json())
    .then(data => {
        document.getElementById('direction').innerHTML =
            `${data.route.start_name} <span>‚Üí</span> ${data.route.end_name}`;

        document.getElementById('stat-ascent').textContent = `+${data.stats.ascent} –º`;
        document.getElementById('stat-distance').textContent = `${data.stats.distance} –∫–º`;
        document.getElementById('stat-time').textContent = data.stats.time;
        document.getElementById('stat-stops').textContent = data.stats.stops;

        const routeEl = document.getElementById('route');
        routeEl.innerHTML = '';

        data.route.points.forEach((point, index) => {
            const el = document.createElement('div');
            el.className =
                'point' +
                (point.type === 'camp' ? ' point-camp' : '') +
                (point.type === 'pass' ? ' point-pass' : '');

            el.innerHTML = `
                <h3>${point.name}</h3>
                <p>${point.type_label}${point.height ? ` ¬∑ ${point.height} –º` : ''}</p>
                <small>${point.lat}, ${point.lon}</small>
            `;
            routeEl.appendChild(el);

            if (index < data.route.points.length - 1) {
                routeEl.appendChild(
                    Object.assign(document.createElement('div'), { className: 'arrow' })
                );
            }
        });
    });
</script>

</body>
</html>
