<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firefly — Find Experience</title>
    <link rel="stylesheet" href="/static/css/routes.css">
</head>
<body>

<a href="/" class="back-btn">BACK</a>

<div class="builder-box">

    <h1 class="title">FIND EXPERIENCE</h1>

    <div class="difficulty-select">
        <div class="difficulty-card active" data-level="1">
            <span class="card-text">VERY EASY</span>
        </div>
        <div class="difficulty-card" data-level="2">
            <span class="card-text">EASY</span>
        </div>
        <div class="difficulty-card" data-level="3">
            <span class="card-text">MEDIUM</span>
        </div>
        <div class="difficulty-card" data-level="4">
            <span class="card-text">HARD</span>
        </div>
        <div class="difficulty-card" data-level="5">
            <span class="card-text">VERY HARD</span>
        </div>
    </div>

    <div class="days-select">
        <div class="days-label-row">
            <span class="days-label">TRIP DURATION</span>
            <span class="days-value"><span id="daysValue">3</span> DAYS</span>
        </div>

        <input
            type="range"
            id="daysSlider"
            min="1"
            max="21"
            step="1"
            value="3"
            class="days-slider"
        />
    </div>

    <div class="points-select">

        <div class="points-header" id="pointsToggle">
            <span class="points-label">INTEREST POINTS</span>
            <span class="points-counter">
                <span id="pointsCount">0</span>/3
            </span>
        </div>

        <div class="points-dropdown" id="pointsDropdown">

            <label class="point-item">
                <input type="checkbox" value="Архыз">
                <span>Архыз</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Баритовый">
                <span>Баритовый</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Запрудное">
                <span>Запрудное</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Бурное">
                <span>Бурное</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Агур Северный">
                <span>Агур Северный</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Мылгвал">
                <span>Мылгвал</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Перевальное">
                <span>Перевальное</span>
            </label>

            <label class="point-item">
                <input type="checkbox" value="Речепста">
                <span>Речепста</span>
            </label>

        </div>
    </div>

    <button class="generate-btn">GENERATE</button>

</div>

<script>
const cards = document.querySelectorAll('.difficulty-card');

cards.forEach(card => {
    card.addEventListener('click', () => {
        cards.forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        updateAccentColor();
        updateDaysLimits();
    });
});

const difficultyColors = {
    1: '#6BFFB8',
    2: '#BFFF6B',
    3: '#FFD966',
    4: '#FF9F5A',
    5: '#FF5A5A'
};

function updateAccentColor() {
    const active = document.querySelector('.difficulty-card.active');
    if (!active) return;

    const level = active.dataset.level;
    const color = difficultyColors[level];

    document.documentElement.style.setProperty('--accent-color', color);
}

const daysSlider = document.getElementById('daysSlider');
const daysValue  = document.getElementById('daysValue');

const daysRules = {
    1: { min: 1,  max: 4  },
    2: { min: 3,  max: 6  },
    3: { min: 5,  max: 10 },
    4: { min: 9,  max: 14 },
    5: { min: 12, max: 21 }
};

function getActiveDifficulty() {
    return document.querySelector('.difficulty-card.active').dataset.level;
}

function updateDaysLimits() {
    const diff = getActiveDifficulty();
    const rule = daysRules[diff];

    daysSlider.min = rule.min;
    daysSlider.max = rule.max;

    if (+daysSlider.value < rule.min) daysSlider.value = rule.min;
    if (+daysSlider.value > rule.max) daysSlider.value = rule.max;

    updateDaysValue();
}

function updateDaysValue() {
    daysValue.textContent = daysSlider.value;
    updateDaysSliderFill();
}

function updateDaysSliderFill() {
    const percent = (daysSlider.value - daysSlider.min) /
        (daysSlider.max - daysSlider.min) * 100;

    daysSlider.style.background = `
        linear-gradient(
            to right,
            var(--accent-color) 0%,
            var(--accent-color) ${percent}%,
            rgba(255,255,255,0.25) ${percent}%,
            rgba(255,255,255,0.25) 100%
        )
    `;
}

daysSlider.addEventListener('input', updateDaysValue);

const pointsToggle = document.getElementById('pointsToggle');
const pointsDropdown = document.getElementById('pointsDropdown');
const pointsCheckboxes = pointsDropdown.querySelectorAll('input[type="checkbox"]');
const pointsCount = document.getElementById('pointsCount');

pointsToggle.addEventListener('click', () => {
    pointsDropdown.classList.toggle('open');
});

pointsCheckboxes.forEach(cb => {
    cb.addEventListener('change', () => {
        const checked = [...pointsCheckboxes].filter(c => c.checked);

        if (checked.length > 3) {
            cb.checked = false;
            return;
        }

        pointsCount.textContent = checked.length;
    });
});

updateAccentColor();
updateDaysLimits();
</script>

</body>
</html>
